{% extends 'base_two_columns.html' %}
{% load highlight %}
{% load om_utils %}
{% load i18n %}
{% load digg_paginator %}
{% load url from future %}

{% block title %}Elenco cariche {% endblock title %}
{% block content_header %}Cariche{% endblock %}
{% block body_class %}charge{% endblock %}

{% block extra_style %}
em {
    background-color: green;
}
{% endblock %}

{% block content %}
{% if n_results %}
<section>
  <h2>{% if not query %}Trovate {% endif %} {{ n_results }} cariche</h2>
    
    {% if person %}
      <p>per: <a href="{{ person.get_absolute_url }}">{{ person }}</a> </p>
    {% endif %}
    
    <table class="data dataTable">
      <thead>
        <tr>
          <th>Carica</th>
          <th>Period</th>
          <th>Gior</th>
          <th>AP</th>
          <th>AR</th>
          <th>DG</th>
          <th>DG /<br />mese</th>
          <th>DC</th>
          <th>DC /<br />mese</th>
          <th>M</th>
          <th>M /<br />mese</th>
          <th>ODG</th>
          <th>ODG /<br />mese</th>
          <th>E</th>
          <th>E /<br />mese</th>
          <th>ITR</th>
          <th>ITR /<br />mese</th>
          <th>ITP</th>
          <th>ITP /<br />mese</th>
          <th>S</th>
          <th>S/<br />mese</th>
        </tr>
      </thead>
      <tbody>
        <tbody>
        {% for result in page.object_list %}
            <tr>
                <td>{{ result.last_name }} {{ result.first_name }}<br />{{ result.institution }}</td>
                <td>{{ result.start_date }}<br />{% if result.end_date %}{{ result.end_date }}{% endif %}</td>
                <td>{{ result.object.duration.days }}</td>
                <td>{% if result.n_presented_acts %}
                	<a href="{% url 'om_act_search' %}?q=&person={{ result.object.person.slug }}">
                	{{ result.n_presented_acts }}</a>
                {% endif %}</td>
                <td>{% if result.n_received_acts %}{{ result.n_received_acts }}{% endif %}</td>
                <td>{% if result.n_cgdeliberations %}
                	<a href="{% url 'om_act_search' %}?q=&person={{ result.object.person.slug }}&selected_facets=act_type:delibera di giunta">
                	{{ result.n_cgdeliberations }}</a>
                {% endif %}</td>
                <td>{% if result.n_cgdeliberations %}{{ result.n_cgdeliberations_index|floatformat:3 }}{% endif %}</td>
                <td>{% if result.n_deliberations %}
                	<a href="{% url 'om_act_search' %}?q=&person={{ result.object.person.slug }}&selected_facets=act_type:delibera">
                	{{ result.n_deliberations }}</a>
                {% endif %}</td>
                <td>{% if result.n_deliberations %}{{ result.n_deliberations_index|floatformat:3 }}{% endif %}</td>
                <td>{% if result.n_motions %}
                	<a href="{% url 'om_act_search' %}?q=&person={{ result.object.person.slug }}&selected_facets=act_type:mozione">
                	{{ result.n_motions }}</a>
                {% endif %}</td>
                <td>{% if result.n_motions %}{{ result.n_motions_index|floatformat:3 }}{% endif %}</td>
                <td>{% if result.n_agendas %}
                	<a href="{% url 'om_act_search' %}?q=&person={{ result.object.person.slug }}&selected_facets=act_type:ordine del giorno">
                	{{ result.n_agendas }}</a>
                {% endif %}</td>
                <td>{% if result.n_agendas %}{{ result.n_agendas_index|floatformat:3 }}{% endif %}</td>
                <td>{% if result.n_amendments %}
                	<a href="{% url 'om_act_search' %}?q=&person={{ result.object.person.slug }}&selected_facets=act_type:emendamento">
                	{{ result.n_amendments }}</a>
                {% endif %}</td>
                <td>{% if result.n_amendments %}{{ result.n_amendments_index|floatformat:3 }}{% endif %}</td>
                <td>{% if result.n_interrogations %}
                	<a href="{% url 'om_act_search' %}?q=&person={{ result.object.person.slug }}&selected_facets=act_type:interrogazione">
                	{{ result.n_interrogations }}</a>
                {% endif %}</td>
                <td>{% if result.n_interrogations %}{{ result.n_interrogations_index|floatformat:3 }}{% endif %}</td>
                <td>{% if result.n_interpellations %}
                	<a href="{% url 'om_act_search' %}?q=&person={{ result.object.person.slug }}&selected_facets=act_type:interpellanza">
                	{{ result.n_interpellations }}</a>
                {% endif %}</td>
                <td>{% if result.n_interpellations %}{{ result.n_interpellations_index|floatformat:3 }}{% endif %}</td>
                <td>{% if result.n_speeches %}
                	<a href="{% url 'om_speech_search' %}?q=&person={{ result.object.person.slug }}">
                	{{ result.n_speeches }}</a>
                {% endif %}</td>
                <td>{% if result.n_speeches %}{{ result.n_speeches_index|floatformat:3 }}{% endif %}</td>
			</tr>
        {% empty %}
            <p>Nessun commento trovato.</p>
        {% endfor %}
        </tbody>
        </table>
        </section>
        {% digg_paginator %}
    {% else %}
        <section class="search-empty">
            <p>
                La ricerca di <strong>{{ form.q.value }}</strong> non Ã¨ andata a buon fine.<br/>
                Controlla che tutte le parole siano state digitate correttamente.</br>
                oppure prova con parole diverse.
            </p>
            <p>
                Grazie,<br/>
                lo staff di Open Municipio
            </p>
        </section>
    {% endif %} 

{% endblock %}

{% block sidebar %}
 
    {% include "om_comments/comments_search_box.html" %}
   
    {% if n_results %}
        {% if selected_facets %}
            <h2>Modifica i filtri</h2>
            {% for facet in selected_facets %}
                <dt>{{ facets_labels|key:facet.field|safe }}</dt>
                <dd>
                    <a href="{{ facet.url }}"><i class="icon-remove"></i></a>
                    {{ facet.r_label }}
                </dd>
            {% endfor %}
    
        {% else %}
            <h2>Filtra</h2>
            <p>Puoi trovare il commento che ti interessa scorrendo la lista 
            degli ultimi pubblicati, qui a fianco.
            Puoi perfezionare la ricerca usando i filtri nella colonna qui sotto, 
            oppure puoi usare il form di ricerca con una parola che pensi sia 
            contenuta nel commento, in cima alla colonna qui a destra</p>
        {% endif %}
    
        <!-- Begin faceting. -->
        <div>
            <dl>
                {% if facets.fields.is_active and not facets.fields.is_active.is_field_selected  %}
                    <dt>{{ facets_labels.is_active }}</dt>
                    {% for t in facets.fields.is_active.counts %}
                        <dd>
                            {% if not t.2 %}
                                <a href="{{ base_url }}&selected_facets=is_active:{{ t.0|urlencode }}">{{ t.0 }}</a> ({{ t.1 }})
                            {% endif %}
                        </dd>
                    {% endfor %}
                {% endif %}
            </dl>

            <dl>
                {% if facets.fields.institution and not facets.fields.institution.is_field_selected  %}
                    <dt>{{ facets_labels.institution }}</dt>
                    {% for t in facets.fields.institution.counts %}
                        <dd>
                            {% if not t.2 %}
                                <a href="{{ base_url }}&selected_facets=institution:{{ t.0|urlencode }}">{{ t.0 }}</a> ({{ t.1 }})
                            {% endif %}
                        </dd>
                    {% endfor %}
                {% endif %}
            </dl>

            <dl>
                {% if not facet_queries_start_date.is_selected %}
                    <dt>{{ facets_labels.start_date }}</dt>
                    {% for range in facet_queries_start_date.ranges|dictsortreversed:"key"  %}
                        <dd>
                            <a href="{{ base_url }}&selected_facets={{ range.key }}">
                                {{ range.label|safe }}
                            </a> ({{ range.count }})
                        </dd>
                    {% endfor %}
                {% endif %}
            </dl>

            <dl>
                {% if not facet_queries_end_date.is_selected %}
                    <dt>{{ facets_labels.end_date }}</dt>
                    {% for range in facet_queries_end_date.ranges|dictsortreversed:"key"  %}
                        <dd>
                            <a href="{{ base_url }}&selected_facets={{ range.key }}">
                                {{ range.label|safe }}
                            </a> ({{ range.count }})
                        </dd>
                    {% endfor %}
                {% endif %}
            </dl>

        </div>
    
        <!-- End faceting -->
    {% endif %}
{% endblock %}
